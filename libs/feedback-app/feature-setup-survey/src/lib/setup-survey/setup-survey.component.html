<nui-feedback-app-page-wrapper
    pageTitle="Setup Survey"
    i18n-pageTitle
>

    <h1
        nui-page-wrapper-title
        i18n
    >
        Setup Survey
    </h1>

    <p nui-page-wrapper-subtitle>
        Customize your survey and share with your subscribers.
    </p>

    <div class="setup-survey">
        <div class="setup-survey__form">

            <nui-card>
                <form
                    class="setup-survey__form__content"
                    [formGroup]="form"
                >

                    <div class="setup-survey__form__content__primary">

                        <nui-radio-card-group>

                            <label
                                nui-label
                                i18n
                            >
                                Metric
                            </label>



                            <nui-radio-card-item>

                                <span radio-card-item-title>üéñ CSAT - Customer Satisfaction Score</span>
                                <span
                                    radio-card-item-subtitle
                                    i18n
                                >
                                    Measure newsletter subscriber satisfaction using Customer Satisfaction Score.
                                </span>
                                <input
                                    type="radio"
                                    name="type"
                                    formControlName="type"
                                    nui-radio-card-item-input
                                    [value]="surveyType.CSAT"
                                >

                            </nui-radio-card-item>

                            <!-- <nui-radio-card-item>

                                <span radio-card-item-title>‚≠êÔ∏è Stars Review</span>
                                <span
                                    radio-card-item-subtitle
                                    i18n
                                >
                                    Identify happy and unhappy users with a stars-based review.
                                </span>
                                <input
                                    type="radio"
                                    name="type"
                                    formControlName="type"
                                    nui-radio-card-item-input
                                    [value]="surveyType.STAR"
                                >

                            </nui-radio-card-item> -->

                            <nui-radio-card-item>

                                <span radio-card-item-title>üëç Like & Dislike</span>
                                <span
                                    radio-card-item-subtitle
                                    i18n
                                >
                                    Find out what your subscribers thinks about your newsletter.
                                </span>
                                <input
                                    type="radio"
                                    name="type"
                                    formControlName="type"
                                    nui-radio-card-item-input
                                    [value]="surveyType.LIKE"
                                >

                            </nui-radio-card-item>

                            <nui-radio-card-item>

                              <span radio-card-item-title>üöÄ NPS - Net Promoter Score</span>
                              <span
                                  radio-card-item-subtitle
                                  i18n
                              >
                                  Measure how likely is that your subscribers would recommend your Newsletter.
                              </span>
                              <input
                                  type="radio"
                                  name="type"
                                  formControlName="type"
                                  nui-radio-card-item-input
                                  [value]="surveyType.NPS"
                              >

                          </nui-radio-card-item>

                        </nui-radio-card-group>

                        <nui-checkbox-field>
                            <input
                                formControlName="customPrimaryQuestionTitle"
                                type="checkbox"
                                name="customPrimaryQuestionTitle"
                            >
                            <label
                                for="customPrimaryQuestionTitle"
                                i18n
                            >
                                Custom title for primary question
                            </label>

                            <span
                                nui-checkbox-subtitle
                                i18n
                            >
                                You can modify the title of the primary question to add your newsletter's name.
                            </span>
                        </nui-checkbox-field>

                        <ng-container *ngIf="form.get('customPrimaryQuestionTitle')?.value || false">
                            <nui-form-field>
                                <label
                                    for="primaryQuestionTitle"
                                    nui-label
                                    i18n
                                >
                                    Primary Question
                                </label>
                                <textarea
                                    name="primaryQuestionTitle"
                                    formControlName="primaryQuestionTitle"
                                    type="text"
                                    nui-input
                                    rows="2"
                                    maxlength="500"
                                ></textarea>

                                <nui-error *ngIf="form.get('primaryQuestionTitle')?.hasError('required')">
                                    <ng-container i18n>
                                        You need to provide a custom question when "Custom title for primary question" is enabled.
                                    </ng-container>
                                </nui-error>

                                <nui-hint>
                                    <ng-container i18n></ng-container>
                                </nui-hint>

                            </nui-form-field>
                        </ng-container>
                    </div>

                    <nui-form-section-separator></nui-form-section-separator>

                    <nui-checkbox-field>
                        <input
                            formControlName="customLogo"
                            type="checkbox"
                            name="customLogo"
                        >
                        <label
                            for="customLogo"
                            i18n
                        >
                            Custom logo
                        </label>

                        <span nui-checkbox-subtitle>
                            Use your newsletter logo as survey logo.
                        </span>
                    </nui-checkbox-field>

                    <div class="setup-survey__form__content__logo" *ngIf="form.get('customLogo')?.value || false">
                        <nui-image-upload
                            titleText="Newsletter Logo"
                            [fileUrl]="(loadedSurvey$ | async)?.logoUrl || null"
                            (fileBase64Change)="patchlogoBase64($event)"
                        ></nui-image-upload>
                    </div>

                    <nui-form-section-separator></nui-form-section-separator>

                    <div class="setup-survey__form__content__secondary">
                        <nui-checkbox-field>
                            <input
                                formControlName="openQuestionEnabled"
                                type="checkbox"
                                name="openQuestionEnabled"
                            >
                            <label
                                for="openQuestionEnabled"
                                i18n
                            >
                                Open question enabled
                            </label>

                            <span nui-checkbox-subtitle>
                                Dive into your subscribers opinions about your newsletter.
                            </span>
                        </nui-checkbox-field>
                        <ng-container *ngIf="form.get('openQuestionEnabled')?.value || false">

                            <nui-checkbox-field>
                                <input
                                    formControlName="openQuestionOptional"
                                    type="checkbox"
                                    name="openQuestionOptional"
                                >
                                <label
                                    for="openQuestionOptional"
                                    i18n
                                >
                                    Open question optional
                                </label>

                                <span nui-checkbox-subtitle>
                                    Your subscribers can finish the survey without answering the open question.
                                </span>
                            </nui-checkbox-field>

                            <nui-checkbox-field>
                                <input
                                    formControlName="customOpenQuestionTitle"
                                    type="checkbox"
                                    name="customOpenQuestionTitle"
                                >
                                <label
                                    for="customOpenQuestionTitle"
                                    i18n
                                >
                                    Custom title for open question
                                </label>

                                <span nui-checkbox-subtitle>
                                    You can modify the title of the open question to ask your subscriber about anything.
                                </span>
                            </nui-checkbox-field>

                            <ng-container *ngIf="form.get('customOpenQuestionTitle')?.value || false">
                                <nui-form-field class="full-width">
                                    <label
                                        for="openQuestionTitle"
                                        nui-label
                                        i18n
                                    >
                                        Open Question
                                    </label>
                                    <textarea
                                        name="openQuestionTitle"
                                        formControlName="openQuestionTitle"
                                        type="text"
                                        nui-input
                                        rows="2"
                                        maxlength="500"
                                    ></textarea>

                                    <nui-error *ngIf="form.get('openQuestionTitle')?.hasError('required')">
                                        <ng-container i18n>
                                            You need to provide a custom question when "Custom title for open question" is enabled.
                                        </ng-container>
                                    </nui-error>

                                </nui-form-field>
                            </ng-container>

                        </ng-container>
                    </div>

                    <nui-form-section-separator></nui-form-section-separator>

                    <div class="setup-survey__form__content__options">
                        <!-- <nui-checkbox-field>
                            <input
                                formControlName="canAnswerMultipleTimes"
                                type="checkbox"
                                name="canAnswerMultipleTimes"
                            >
                            <label
                                for="canAnswerMultipleTimes"
                                i18n
                            >
                                Allow users to answer survey multiple times.
                            </label>

                            <span nui-checkbox-subtitle>
                                Users will be able to answer the survey multiple times by revisiting it's URL.
                            </span>
                        </nui-checkbox-field> -->

                        <nui-checkbox-field>
                            <input
                                formControlName="redirectAfterCompleted"
                                type="checkbox"
                                name="redirectAfterCompleted"
                            >
                            <label
                                for="redirectAfterCompleted"
                                i18n
                            >
                                Redirect after completed
                            </label>

                            <span nui-checkbox-subtitle>
                                Redirect user to any URL after finishing interview.
                            </span>
                        </nui-checkbox-field>

                        <ng-container *ngIf="form.get('redirectAfterCompleted')?.value || false">
                            <nui-form-field id="redirectAfterCompletedUrl">
                                <label
                                    for="redirectAfterCompletedUrl"
                                    nui-label
                                    i18n
                                >
                                    Redirect URL
                                </label>
                                <input
                                    name="redirectAfterCompletedUrl"
                                    formControlName="redirectAfterCompletedUrl"
                                    type="text"
                                    nui-input
                                    maxlength="255"
                                >
                                <nui-error *ngIf="form.get('redirectAfterCompletedUrl')?.hasError('required')">
                                    <ng-container i18n>
                                        You must provide a redirect URL when "Redirect after completed" is enabled.
                                    </ng-container>
                                </nui-error>

                                <nui-error *ngIf="form.get('redirectAfterCompletedUrl')?.hasError('invalidUrl')">
                                    <ng-container i18n>Invalid URL format.</ng-container>
                                </nui-error>

                            </nui-form-field>
                        </ng-container>

                    </div>

                </form>
            </nui-card>

            <div class="setup-survey__form__actions">
                <button
                    type="button"
                    nui-primary-button
                    (click)="onSubmit()"
                    [loading]="(setuppingSurvey$ | async) || false"
                    i18n
                >
                    Publish Survey
                </button>
            </div>
        </div>
        <div class="setup-survey__preview">

            <nui-card [noPadding]="true">
                <nui-browser-frame>

                    <div class="setup-survey__preview__content">

                      <div class="setup-survey__preview__content__logo">

                        <img [src]="form.get('logoBase64')?.value || 'assets/logo/logo01.png'" alt="Survey logo">

                      </div>

                        <ng-container [ngSwitch]="form.value.type">

                            <nui-generic-question *ngSwitchCase="surveyType.NPS">
                                <h2 nui-question-title>{{ form.value.primaryQuestionTitle }}</h2>

                                <nui-question-radio-answer *ngFor="let range of NPSRange">
                                    <input
                                        type="radio"
                                        name="aaa"
                                        nui-question-radio-answer-input
                                        [value]="range"
                                    >
                                    {{ range }}
                                </nui-question-radio-answer>
                            </nui-generic-question>

                            <nui-generic-question *ngSwitchCase="surveyType.CSAT">
                                <h2 nui-question-title>{{ form.value.primaryQuestionTitle }}</h2>

                                <nui-question-radio-answer>
                                    <input
                                        type="radio"
                                        name="aaa"
                                        nui-question-radio-answer-input
                                        [value]="0"
                                    >
                                    üò°
                                </nui-question-radio-answer>

                                <nui-question-radio-answer>
                                    <input
                                        type="radio"
                                        name="aaa"
                                        nui-question-radio-answer-input
                                        [value]="1"
                                    >
                                    üòï
                                </nui-question-radio-answer>

                                <nui-question-radio-answer>
                                    <input
                                        type="radio"
                                        name="aaa"
                                        nui-question-radio-answer-input
                                        [value]="2"
                                    >
                                    üòê
                                </nui-question-radio-answer>

                                <nui-question-radio-answer>
                                    <input
                                        type="radio"
                                        name="aaa"
                                        nui-question-radio-answer-input
                                        [value]="3"
                                    >
                                    üòä
                                </nui-question-radio-answer>

                                <nui-question-radio-answer>
                                    <input
                                        type="radio"
                                        name="aaa"
                                        nui-question-radio-answer-input
                                        [value]="4"
                                    >
                                    üòç
                                </nui-question-radio-answer>
                            </nui-generic-question>

                            <nui-generic-question *ngSwitchCase="surveyType.LIKE">
                                <h2 nui-question-title>{{ form.value.primaryQuestionTitle }}</h2>

                                <nui-question-radio-answer>
                                    <input
                                        type="radio"
                                        name="aaa"
                                        nui-question-radio-answer-input
                                        [value]="0"
                                    >
                                    üëé
                                </nui-question-radio-answer>

                                <nui-question-radio-answer>
                                    <input
                                        type="radio"
                                        name="aaa"
                                        nui-question-radio-answer-input
                                        [value]="1"
                                    >
                                    üëç
                                </nui-question-radio-answer>
                            </nui-generic-question>

                        </ng-container>

                    </div>

                </nui-browser-frame>
            </nui-card>

        </div>
    </div>
</nui-feedback-app-page-wrapper>
